<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cloud9 Streaming â€” Upload Videos</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{ --c9-blue:#078fef; --c9-deep:#0d4473; --ink:#101828; --muted:#667085; }
    *{box-sizing:border-box}
    body{ margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:var(--ink); background-color:#000000; display:flex; flex-direction:column; min-height:100vh; }
    header{ display:flex; align-items:center; justify-content:space-between; padding:20px 40px; background:#fff; border-bottom:1px solid #e6eef7; }
    header img{ height:48px }
    nav a{ margin-left:20px; text-decoration:none; color:var(--c9-deep); font-weight:600; font-size:15px }
    nav a:hover{ text-decoration:underline }
    main{ flex:1; display:flex; gap:32px; padding:40px; align-items:flex-start; justify-content:center }
    .upload-container{ flex:1; max-width:820px; background:#fff; padding:40px; border-radius:12px; box-shadow:0 8px 24px rgba(13,68,115,.06) }
    h1{ margin:0 0 12px; color:var(--c9-deep); font-size:28px }
    .subtitle{ color:var(--muted); font-size:15px; margin-bottom:32px }
    .upload-zone{ border:2px dashed #e6eef7; border-radius:12px; padding:60px 40px; text-align:center; background:#f5fbff; cursor:pointer; transition:all 0.3s }
    .upload-zone:hover{ border-color:var(--c9-blue); background:#e6f5ff }
    .upload-zone.dragover{ border-color:var(--c9-blue); background:#e6f5ff; transform:scale(1.02) }
    .upload-icon{ font-size:48px; margin-bottom:16px; color:var(--c9-blue) }
    .upload-text{ color:var(--c9-deep); font-weight:600; font-size:16px; margin-bottom:8px }
    .upload-hint{ color:var(--muted); font-size:14px }
    .file-input{ display:none }
    .form-group{ margin-top:24px }
    .form-group label{ display:block; color:var(--c9-deep); font-weight:600; font-size:14px; margin-bottom:8px }
    .form-group input, .form-group textarea{ width:100%; padding:12px 16px; border:1px solid #e6eef7; border-radius:8px; font-family:inherit; font-size:14px; color:var(--ink) }
    .form-group input:focus, .form-group textarea:focus{ outline:none; border-color:var(--c9-blue); box-shadow:0 0 0 3px rgba(7,143,239,0.1) }
    .form-group textarea{ resize:vertical; min-height:80px }
    .upload-btn{ display:inline-block; margin-top:24px; background:linear-gradient(180deg,#1aa0ff,var(--c9-blue)); color:#fff; padding:14px 32px; border-radius:10px; border:none; font-weight:600; font-size:15px; cursor:pointer; transition:transform 0.2s }
    .upload-btn:hover{ transform:translateY(-2px) }
    .upload-btn:disabled{ opacity:0.5; cursor:not-allowed; transform:none }
    .file-preview{ margin-top:20px; padding:16px; background:#f5fbff; border-radius:8px; display:none }
    .file-preview.show{ display:block }
    .file-name{ color:var(--c9-deep); font-weight:600; font-size:14px }
    .file-size{ color:var(--muted); font-size:13px; margin-top:4px }
    .progress-bar{ width:100%; height:8px; background:#e6eef7; border-radius:4px; margin-top:12px; overflow:hidden; display:none }
    .progress-bar.show{ display:block }
    .progress-fill{ height:100%; background:linear-gradient(90deg,#1aa0ff,var(--c9-blue)); width:0%; transition:width 0.3s }
    .status-message{ margin-top:16px; padding:12px 16px; border-radius:8px; font-size:14px; display:none }
    .status-message.show{ display:block }
    .status-message.success{ background:#d1fae5; color:#065f46 }
    .status-message.error{ background:#fee2e2; color:#991b1b }
    footer{ text-align:center; color:#98a2b3; font-size:13px; padding:20px; background:#fff; border-top:1px solid #e6eef7 }
    @media (max-width:900px){ main{ flex-direction:column; padding:20px } .upload-container{ width:100%; padding:24px } }
  </style>
</head>
<body>
  <header>
    <img src="{{ url_for('static', filename='cloud9-logo.png') }}" alt="Cloud9 Streaming Logo" />
    <nav>
      <a href="/">Home</a>
      <a href="/videos">Videos</a>
      <a href="/login">Login</a>
      <a href="/about">About</a>
      <a href="/team">Team</a>
      <a href="/contact">Contact</a>
      <a href="/legal">Legal</a>
    </nav>
  </header>

  <main>
    <div class="upload-container">
      <h1>Upload Video</h1>
      <p class="subtitle">Share your content with the Cloud9 streaming community</p>

      <div class="upload-zone" id="uploadZone">
        <div class="upload-icon">ðŸ“¹</div>
        <div class="upload-text">Click to select or drag and drop your video</div>
        <div class="upload-hint">Supports MP4, MOV, AVI (Max 2GB)</div>
      </div>
      <input type="file" id="fileInput" class="file-input" accept="video/*">

      <div class="file-preview" id="filePreview">
        <div class="file-name" id="fileName"></div>
        <div class="file-size" id="fileSize"></div>
        <div class="progress-bar" id="progressBar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
      </div>

      <div class="form-group">
        <label for="videoTitle">Video Title *</label>
        <input type="text" id="videoTitle" placeholder="Enter a descriptive title" required>
      </div>

      <div class="form-group">
        <label for="videoDescription">Description</label>
        <textarea id="videoDescription" placeholder="Tell viewers about your video"></textarea>
      </div>

      <button class="upload-btn" id="uploadBtn" disabled>Upload Video</button>

      <div class="status-message" id="statusMessage"></div>
    </div>
  </main>

  <footer>
    Â© <span id="year"></span> Cloud9 Streaming. All rights reserved.
  </footer>

  <script>
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    const filePreview = document.getElementById('filePreview');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const uploadBtn = document.getElementById('uploadBtn');
    const progressBar = document.getElementById('progressBar');
    const progressFill = document.getElementById('progressFill');
    const statusMessage = document.getElementById('statusMessage');
    const videoTitle = document.getElementById('videoTitle');
    const videoDescription = document.getElementById('videoDescription');

    let selectedFile = null;

    // Click to upload
    uploadZone.addEventListener('click', () => fileInput.click());

    // File selection
    fileInput.addEventListener('change', (e) => {
      handleFile(e.target.files[0]);
    });

    // Drag and drop
    uploadZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadZone.classList.add('dragover');
    });

    uploadZone.addEventListener('dragleave', () => {
      uploadZone.classList.remove('dragover');
    });

    uploadZone.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadZone.classList.remove('dragover');
      handleFile(e.dataTransfer.files[0]);
    });

    function handleFile(file) {
      if (!file) return;
      
      if (!file.type.startsWith('video/')) {
        showStatus('Please select a valid video file', 'error');
        return;
      }

      if (file.size > 2 * 1024 * 1024 * 1024) {
        showStatus('File size must be less than 2GB', 'error');
        return;
      }

      selectedFile = file;
      fileName.textContent = file.name;
      fileSize.textContent = formatFileSize(file.size);
      filePreview.classList.add('show');
      uploadBtn.disabled = false;
      statusMessage.classList.remove('show');
    }

    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      if (bytes < 1024 * 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
      return (bytes / (1024 * 1024 * 1024)).toFixed(1) + ' GB';
    }

    uploadBtn.addEventListener('click', async () => {
      if (!selectedFile) return;
      
      if (!videoTitle.value.trim()) {
        showStatus('Please enter a video title', 'error');
        return;
      }

      if (!videoDescription.value.trim()) {
        showStatus("Please enter a video description", "error");
        return;
      }

      uploadBtn.disabled = true;

      uploadFile();
    });

    function showStatus(message, type) {
      statusMessage.textContent = message;
      statusMessage.className = 'status-message show ' + type;
    }

    async function uploadFile() {
        progressBar.classList.add('show');

        const formData = new FormData();
        formData.append("file", selectedFile);

        const xhr = new XMLHttpRequest();

        // Track upload progress
        xhr.upload.addEventListener('progress', (e) => {
            if (e.lengthComputable) {
                const percentComplete = (e.loaded / e.total) * 100;
                console.log(`Upload progress: ${percentComplete.toFixed(2)}%`);
                progressFill.style.width = (percentComplete * 0.95) + '%';
                // Update your UI here
            }
        });

        xhr.addEventListener('load', async () => {
            if (xhr.status === 200) {
                const data = JSON.parse(xhr.responseText);
                console.log('Upload complete:', data);

                await fetch(window.location.origin + "/upload-video-details", {
                    method: "POST",
                    headers: {
                        "Content-type": "application/json; charset=UTF-8",
                        "Origin": window.location.origin + ""
                    },
                    body: JSON.stringify({
                        "title": videoTitle.value,
                        "description": videoDescription.value,
                        "video_file": selectedFile.name.split(".")[0]
                    })
                }).then(res => {
                    if (res.ok) {
                        window.setTimeout(() => {
                            showStatus('Video uploaded successfully!', 'success');
                            progressFill.style.width = '100%';
                        }, 1000);
                    } else {
                        showStatus("Something went wrong", "error");
                    }
                }).catch(err => {
                    showStatus("Something went wrong", "error");
                });
            }
        });

        xhr.addEventListener('error', () => {
            console.error('Upload failed');
        });

        xhr.open('POST', window.location.origin + "/upload-video");
        xhr.setRequestHeader('Origin', window.location.origin);
        xhr.send(formData);
    }

    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>